<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天気予報取得ツール</title>
    <style>
        body { font-family: sans-serif; margin: 20px; line-height: 1.6; }
        .input-group { margin-bottom: 10px; }
        label { display: inline-block; width: 100px; }
        button { padding: 5px 15px; cursor: pointer; }
        .result-container { display: flex; gap: 20px; margin-top: 20px; }
        .weather-card {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            width: 200px;
            background-color: #f9f9f9;
        }
        .day-title { font-weight: bold; border-bottom: 1px solid #ddd; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>天気予報検索</h2>

    <div class="input-group">
        <label>地名:</label>
        <input type="text" id="locationName" placeholder="例：東京">
    </div>
    <div class="input-group">
        <label>緯度:</label>
        <input type="number" id="lat" step="0.01" value="35.6895">
    </div>
    <div class="input-group">
        <label>経度:</label>
        <input type="number" id="lng" step="0.01" value="139.6917">
    </div>
    <button onclick="getWeather()">天気表示</button>

    <h3 id="displayLocation">---</h3>

    <div class="result-container">
        <div id="today-weather" class="weather-card">
            <div class="day-title">今日</div>
            <p>天気: <span id="t-condition">-</span></p>
            <p>最高: <span id="t-max">-</span>℃</p>
            <p>最低: <span id="t-min">-</span>℃</p>
        </div>

        <div id="tomorrow-weather" class="weather-card">
            <div class="day-title">明日</div>
            <p>天気: <span id="tm-condition">-</span></p>
            <p>最高: <span id="tm-max">-</span>℃</p>
            <p>最低: <span id="tm-min">-</span>℃</p>
        </div>
    </div>

    <script>
        /**
         * Open-MeteoのWMO天気コードを日本語の名称に変換する関数
         * @param {number} code 天気コード
         */
        function getWeatherText(code) {
            const weatherCodes = {
                0: "快晴", 1: "晴れ", 2: "時々曇り", 3: "曇り",
                45: "霧", 48: "霧氷",
                51: "小雨", 53: "雨", 55: "強い雨",
                61: "小雨", 63: "雨", 65: "激しい雨",
                71: "小雪", 73: "雪", 75: "激しい雪",
                80: "にわか雨", 81: "雨", 82: "激しいにわか雨",
                95: "雷雨"
            };
            return weatherCodes[code] || "不明";
        }

        /**
         * APIから天気を取得するメイン関数
         */
        async function getWeather() {
            // 1. 入力値の取得
            const lat = document.getElementById('lat').value;
            const lng = document.getElementById('lng').value;
            const locName = document.getElementById('locationName').value || "指定された場所";

            // 2. Open-Meteo APIのURL構築
            // dailyパラメータで最高気温、最低気温、天気コードを指定
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo`;

            try {
                // 3. APIリクエストの送信
                const response = await fetch(url);
                const data = await response.json();

                // 4. 地名の表示更新
                document.getElementById('displayLocation').innerText = `${locName}の天気`;

                // 5. 今日のデータを表示 (配列の0番目)
                document.getElementById('t-condition').innerText = getWeatherText(data.daily.weathercode[0]);
                document.getElementById('t-max').innerText = data.daily.temperature_2m_max[0];
                document.getElementById('t-min').innerText = data.daily.temperature_2m_min[0];

                // 6. 明日のデータを表示 (配列の1番目)
                document.getElementById('tm-condition').innerText = getWeatherText(data.daily.weathercode[1]);
                document.getElementById('tm-max').innerText = data.daily.temperature_2m_max[1];
                document.getElementById('tm-min').innerText = data.daily.temperature_2m_min[1];

            } catch (error) {
                console.error("データの取得に失敗しました:", error);
                alert("データの取得に失敗しました。緯度・経度が正しいか確認してください。");
            }
        }
    </script>
</body>
</html>